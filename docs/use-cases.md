# D2 — Use-case Narrative

## 1. Краткое описание

Сценарий описывает основной поток «Подбор подарка и установка напоминания», где пользователь получает персонализированные рекомендации от AI, выбирает вариант и ставит напоминание/задачу. Документ включает основной (happy path), альтернативные потоки, обработку ошибок, ценности для пользователя, UML-диаграммы и чек-лист Definition of Done.

## 2. Акторы

- Пользователь (Primary Actor) — человек, который ищет подарок и/или настраивает напоминание.

- AI Engine - внешний актор для генерации списка подарков.

- База данных - внешний актор для хранения информации.

- E-mail-сервис - внешний актор для отправки уведомлений и подтверждений на электронную почту.

## 3. Основные use-case:

## "Подбор подарка" (Happy Path)

**Цель**: пользователь получает подходящие варианты подарков.

**Шаги:**

1. (UI) Пользователь открывает главную страницу и видит поле для ввода
2. (UI) Пользователь добавляет аккаунт получателя подарка, ранее зарегистрированный на сайте, и уточняющую информацию в текстовом виде
3. (Frontend) Текстовое поле валидируется локально.
4. (Frontend → Backend API) Отправляется запрос POST /api/recommendations с профилем получателя, бюджетом, тегами и опциями (кол-во вариантов N).
5. (Backend) Принимает запрос, формирует prompt/вход для AI.
6. (AI) Модель генерирует ранжированные рекомендации (N вариантов) с кратким описанием, ссылками на товары и оценкой релевантности.
7. (Frontend) Отображает пользователю список рекомендаций с коротким описанием и изображением товаров.

---

## "Регистрация пользователя" (Happy Path)

**Цель**: пользователь успешно создает аккаунт.

**Шаги:**

1. (UI) Пользователь нажимает на кнопку "Войти" и переходит на страницу авторизации.
2. (UI) Пользователь нажимает на кнопку "Нет аккаунта" и переходит на страницу регистрации.
3. (UI) Пользователь вводит свой электронный адрес и пароль в соответствующие текстовые поля.
4. (Frontend) Текстовые поля валидируются локально (все поля заполнены, пароли совпадают).
5. (Frontend → Backend API) Отправляется запрос POST /api/user с электронным адресом и паролем.
6. (Backend) Отправляет подтверждение на электронную почту пользователя.
7. (Frontend) Открывает страницу профиля пользователя после перехода по ссылке.

---

## "Изменение профиля пользователя" (Happy Path)

**Цель**: Пользователь успешно изменяет профиль.

**Шаги:**

1. (UI) Пользователь переходит на страницу профиля.
2. (UI) Пользователь нажимает на кнопку "Редактировать" и переходит в режим редактирования.
3. (UI) Пользователь выбирает аватарку, вводит имя, фамилию, день рождения, ссылку на телеграмм-аккаунт и информацию о себе в соответствующие текстовые поля, выбирает гендер из выпадающего списка.
4. (Frontend) Текстовые поля валидируются локально (все обязательные поля заполнены, имя и фамилия начинаются с заглавной буквы).
5. (Frontend → Backend API) Отправляется запрос PUT /api/user с изменяемой информацией.
6. (Frontend) Отображает пользователю страницу профиля с обновленной информацией.

---

## "Восстановление пароля" (Happy Path)

**Цель**: Пользователь успешно восстанавливает пароль.

**Шаги:**

1. (UI) Пользователь переходит на страницу авторизации.
2. (UI) Пользователь нажимает на кнопку "Забыли пароль?".
3. (Frontend) Переводит пользователя на страницу восстановления пароля.
4. (UI) Пользователь вводит адрес электронной почты в соответствующее текстовое поле.
5. (Frontend) Текстовые поля валидируются локально (все обязательные поля заполнены).
6. (Frontend → Backend API) Отправляется запрос POST /api/user/recover с адресом электронной почты.
7. (Backend) Отправляет подтверждение на электронную почту пользователя.
8. (Frontend) Открывает страницу восстановления пароля после перехода по ссылке.
9. (UI) Пользователь заполняет текстовые поля с паролями.
10. (Frontend) Текстовые поля валидируются локально (все поля заполнены, пароли совпадают).
11. (Frontend) Переводит пользователя на страницу авторизации.

---

## "Добавление напоминания" (Happy Path)

**Цель**: Пользователь успешно создает напоминание.

**Шаги:**

1. (UI) Пользователь открывает страницу календаря.
2. (UI) Пользователь нажимает на ячейку календаря.
3. (Frontend) Отображает пользователю форму для создания напоминания.
4. (UI) Пользователь заполняет форму создания напоминания (название события, описание события, аккаунт получателя, ссылка на телеграм получателя, дополнительная информация о получателе).
5. (Frontend) Форма валидируется локально (все обязательные поля заполнены)
6. (Frontend → Backend API) Отправляется запрос POST /api/remind с заполненной формой.
7. (Frontend) Отображает сообщение об успешном создании напоминания.

---

## 4. Alternative Flows

## "Подбор подарка" (Alternative Flow)

**Сценарий**: Пользователь ввёл некорректные данные или не найден профиль получателя.

**Шаги:**

1. (UI) Пользователь вводит аккаунт получателя (ошибочно или аккаунт отсутствует в базе).
2. (Frontend) Выполняет локальную валидацию и/или отправляет запрос к API.
3. (Backend) Возвращает ошибку `404 Not Found` или `400 Bad Request`.
4. (Frontend) Отображает пользователю сообщение:

   - "Профиль получателя не найден."
   - или "Введите корректные данные."

5. (UI) Пользователь может повторно ввести данные или выбрать опцию "Подобрать подарок без профиля" (с ручным вводом интересов/тегов).

---

## "Регистрация пользователя" (Alternative Flow)

**Сценарий**: Пользователь указывает уже существующий email.

**Шаги:**

1. (UI) Пользователь вводит email и пароль.
2. (Frontend) Валидирует поля и отправляет запрос `POST /api/user`.
3. (Backend) Проверяет существование email.
4. (Backend) Возвращает ошибку `409 Conflict` (аккаунт уже существует).
5. (Frontend) Отображает сообщение:

   - "Аккаунт с таким email уже зарегистрирован."

6. (UI) Пользователю предлагается перейти на страницу авторизации или восстановить пароль.

---

## "Восстановление пароля" (Alternative Flow)

**Сценарий**: Пользователь вводит несуществующий email.

**Шаги:**

1. (UI) Пользователь вводит email в форму восстановления пароля.
2. (Frontend) Валидирует поле и отправляет запрос `POST /api/user/recover`.
3. (Backend) Проверяет наличие email в системе.
4. (Backend) Возвращает ошибку `404 Not Found`.
5. (Frontend) Отображает сообщение:

   - "Указанный email не найден. Попробуйте снова."

6. (UI) Пользователь может повторно ввести email или перейти к регистрации.

---

## 5. Error Handling (минимум 3 сценария)

### Сценарий 1 — Ошибка сети при запросе к API

**Ситуация:** У пользователя нестабильное интернет-соединение, запрос к серверу не доходит.

**Шаги:**

1. (Frontend) Отправляется запрос к Backend API.
2. (Network) Соединение прерывается или сервер не отвечает.
3. (Frontend) Получает ошибку `Network Error` / `504 Gateway Timeout`.
4. (Frontend) Отображает сообщение пользователю:

   - "Ошибка соединения. Проверьте интернет и попробуйте снова."

5. (UI) Пользователю предлагается повторить действие (Retry).

---

### Сценарий 2 — Ошибка валидации данных на Backend

**Ситуация:** Пользователь ввёл некорректные данные, которые прошли локальную валидацию, но не соответствуют правилам на сервере.

**Шаги:**

1. (Frontend) Отправляет данные на сервер.
2. (Backend) Проверяет корректность полей (например, слишком короткий пароль, недопустимые символы).
3. (Backend) Возвращает ошибку `422 Unprocessable Entity`.
4. (Frontend) Отображает сообщение:

   - "Некорректные данные. Проверьте ввод и повторите попытку."

5. (UI) Пользователь исправляет данные и повторяет ввод.

---

### Сценарий 3 — Внутренняя ошибка сервера

**Ситуация:** При обработке запроса на стороне сервера происходит сбой.

**Шаги:**

1. (Frontend) Отправляет корректный запрос.
2. (Backend) При выполнении операции возникает ошибка (например, сбой базы данных).
3. (Backend) Возвращает ошибку `500 Internal Server Error`.
4. (Frontend) Отображает сообщение:

   - "Произошла внутренняя ошибка сервера. Пожалуйста, попробуйте позже."

5. (UI) Пользователю предлагается вернуться на главную страницу или повторить действие позже.

---

## 6. User Value — простые выгоды по сценариям

### "Подбор подарка"

- Пользователь быстро получает список релевантных подарков без долгих поисков.
- Экономит время и силы на выборе.
- Минимизирует риск ошибиться с подарком (AI учитывает профиль и предпочтения).

---

### "Регистрация пользователя"

- Получает персонализированный аккаунт с сохранением истории действий.
- Может пользоваться всеми функциями сервиса (рекомендации, напоминания, редактирование профиля).
- Чувствует уверенность в сохранности данных (почта и пароль защищены).

---

### "Изменение профиля пользователя"

- Пользователь может обновлять данные о себе в любой момент.
- Сервис подбирает более точные рекомендации на основе актуального профиля.
- Повышается доверие: профиль отражает реальную личность, а не устаревшую информацию.

---

### "Восстановление пароля"

- Пользователь не теряет доступ к аккаунту даже при забытом пароле.
- Сервис гарантирует безопасность восстановления (через подтверждение по email).
- Снижается риск навсегда потерять данные и рекомендации.

---

### "Добавление напоминания"

- Пользователь может заранее планировать важные события (дни рождения, праздники).
- Снижается вероятность забыть поздравить близких.
- Повышается удобство: всё хранится в одном месте, доступно онлайн.
