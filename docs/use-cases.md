# D2 — Use-case Narrative

## 1. Краткое описание

Сценарий описывает основной поток «Подбор подарка и установка напоминания», где пользователь получает персонализированные рекомендации от AI, выбирает вариант и ставит напоминание/задачу. Документ включает основной (happy path), альтернативные потоки, обработку ошибок, ценности для пользователя, UML-диаграммы и чек-лист Definition of Done.

## 2. Акторы

- Пользователь (Primary Actor) — человек, который ищет подарок и/или настраивает напоминание.

- AI Gift Assistant (System) — backend + AI сервисы, база данных, уведомления.

- Fullstack разработчик — реализует API и UI.

- SA/PO — поддерживает приоритизацию, предоставляет бизнес-правила и подписывает DoD.

- Внешние сервисы — платёжный шлюз, поставщики (товары), пуш-уведомления, календарь (опционально).

## 3. Основной use-case: "Подбор подарка и установка напоминания" (Happy Path)

**Цель**: пользователь получает подходящие варианты подарков и создаёт напоминание о покупке/дате.

**Шаги:**

1. (UI) Пользователь открывает главную страницу и видит поле для ввода, а также форму для быстрого составления запроса: для кого подарок (имя/роль), возраст/пол/интересы, бюджет, дата события, предпочтения/запреты (например, "без алкоголя").

2. (UI) Пользователь заполняет форму (может выбрать быстрые шаблоны: "Девушка — 25 — хобби: йога") или текстовый запрос со схожими параметрами.

3. (Frontend) Форма и текстовое поле валидируются локально (обязательные поля, корректный формат даты, числовой бюджет).

4. (Frontend → Backend API) Отправляется запрос POST /api/recommendations с профилем получателя, бюджетом, тегами и опциями (кол-во вариантов N).

5. (Backend) Принимает запрос, сохраняет сессию поиска (audit), формирует prompt/вход для AI.

6. (AI) Модель генерирует ранжированные рекомендации (N вариантов) с кратким описанием, ссылками на товары и оценкой релевантности.

7. (Frontend) Отображает пользователю список рекомендаций с коротким описанием, ценой и кнопками: "Сохранить", "Создать напоминание".

8. (User) Выбирает вариант и нажимает "Создать напоминание".

9. (Frontend → Backend) Запрос POST /api/reminders с параметрами: текст напоминания, дата/время, ссылка на товар.

10. (Backend) Сохраняет напоминание.

11. (Frontend) Показывает подтверждение "Напоминание создано" и предоставляет опции: "Добавить в календарь".

12. (System) В назначенный момент отправляет push/email/внутреннее уведомление; если пользователь не отменил напоминание, предлагает повторный набор рекомендаций.

##### Пояснения: каждый шаг логируется и имеет метрики (latency AI, success rate, клики по рекомендациям).

## 4. Alternative Flows

##### 1. Альтернативный сценарий A: Неправильный ввод / неполная информация

- (Frontend) Если обязательные поля не заполнены или формат неверный — показываются inline ошибки.
- (User) ИСПРАВЛЯЕТ ввод; можно выбрать "Помочь заполнить" — запускается короткий Q&A (в виде диалога) для уточнения (AI задаёт вопросы: "он любит спорт?" и т.д.).
- (System) Если данных всё ещё недостаточно, предлагает шаблонные варианты по похожим профилям (например, "подарок для коллеги").

##### User value: снижает ошибки ввода, ускоряет процесс подбора, повышает релевантность рекомендаций.

---

##### 2. Альтернативный сценарий B: отсутствие интернет-соединения

- (Trigger) Пользователь пытается выполнить любое действие, требующее сети (получить рекомендации или создать напоминание) без подключения.
- (Frontend) Определяет отсутствие сети и показывает понятное сообщение: "Нет соединения — подключитесь к интернету, чтобы использовать эту функцию." Все функции, требующие сервера, недоступны.

##### User value: пользователь получает ясную обратную связь — понятно, что нужно подключиться; приложение не пытается сохранять данные локально или выполнять синхронизацию.

## 5. Error Handling (минимум 3 сценария)

- ##### Ошибка 1 — Технический сбой AI-сервиса

  Обнаружение: backend получает timeout или 5xx от AI. Реакция:
  вернуть пользователю сообщение: "Сервис временно недоступен, попробуйте позже.";
  retry с экспоненциальной задержкой (3 попытки);

  ##### User value: поддержание доступности сервиса, снижение времени простоя, уменьшение риска потери пользователя.

- ##### Ошибка 2 — Некорректный ввод
  Обнаружение: frontend/backend валидация не прошла (например, дата в прошлом, пустое имя). Реакция:
  показывать точную inline-ошибку с подсказкой (например, "Дата не может быть в прошлом — выберите будущую дату");
  если ошибка на backend (malformed JSON), возвращать 400 с описанием поля;
  ##### User value: снижение ошибок, ускорение процесса, повышение доверия.

## 6. User Value — простые выгоды по сценариям (без кэша и без синхронизации)

#### Happy Path:

**Выгода:** быстро получить подходящие подарки и сразу поставить напоминание.  
**Пример:** заполнил пару полей → получил 5 вариантов → сохранил понравившийся.  
**Простая метрика:** время до показа рекомендаций; % сессий, где пользователь сохранил вариант.

---

#### Оффлайн режим (нет кэша, нет синхронизации)

**Выгода:** приложение информирует пользователя, что для работы нужен интернет. Никакие данные не сохраняются локально и не синхронизируются.  
**Пример:** при отсутствии сети показывается сообщение «Нет соединения — откройте приложение при подключении». Функции подбора и создания напоминаний недоступны.  
**Простая метрика:** количество сессий, в которых пользователь столкнулся с отсутствием сети (и % таких сессий, прерванных).

---

#### Неправильный ввод

**Выгода:** простые подсказки уменьшают количество ошибок и ускоряют заполнение формы.  
**Пример:** если введена дата в прошлом — показывается подсказка «выберите будущую дату».  
**Простая метрика:** количество ошибок в форме (валидатор) до/после улучшений.

---

#### Технические сбои

**Выгода:** при недоступности сервиса показываем понятное сообщение; это означает только информирование пользователя и предложение повторить позже.  
**Пример:** AI-сервис недоступен → приложение показывает «Сервис временно недоступен, попробуйте позже».  
**Простая метрика:** количество инцидентов и % пользователей, повторивших попытку позже.

---

#### Превышение лимитов

**Выгода:** при перегрузке показываем понятное сообщение и даём опцию: повторить позже.
**Пример:** при перегрузке система возвращает «Сервис сейчас перегружен — попробуйте позже».  
**Простая метрика:** число видимых 429-ошибок; % пользователей, повторивших запрос позже.
